<?phpnamespace app\api\controller\v1;use app\api\controller\BaseController;use app\api\model\Shoperinfo as ShoperinfoModel;use app\lib\exception\ParameterException;use app\api\validate\ShoperNew;use think\Db;// 骑手信息控制器class Shoper extends BaseController{    //申青成为骑手    public function addShoper()    {        //验证传入值        $validate = new ShoperNew();        $validate->goCheck();        $post = $validate->getDataByRule(input('post.'));        // 获取用户信息        $user = $this->getUid();        // 验证商家        		$mt_shoper =  Db::table('sbw_userinfo')->where('user_phone', $post['mobile'])->find();		if(!$mt_shoper){			return show(201, '平台暂无该用户');		}		$mt_shoper_user = Db::table('sbw_user')->where('user_id',$mt_shoper['user_id'])->find();		$post['user_id'] = $mt_shoper_user['user_id'];//		if($mt_shoper_user['user_role'] == '4' ){//			return show(201, '该用户是企业用户，没有办法操作');//		}		$shoper = ShoperinfoModel::getByUserID($mt_shoper_user['user_id']);        if($shoper) {				return show(201, '已是骑手，无法再次添加');       }else{            try{                (new ShoperinfoModel())->allowField(true)->save($post);                Db::table('sbw_user')->where('user_id',$mt_shoper['user_id'])->update(['user_role'=>2]);	// 更新状态            }catch(\Exception $e){                return show(201,"添加失败");            }            return show(200,"成功");        }    }    // 骑手配送时得到用户点的经纬度    public function getLatLng(){        $address = trim(input("post.address"));        if(!$address){            return show(201,'没有地址，经纬度获取失败');        }        $res = \Tmap::getLngLat($address);        if(!$res){          return show(201,'经纬度获取失败');        }        //经度        $data['longitude'] =$res['result']['location']['lng'];        //纬度        $data['latitude'] =$res['result']['location']['lat'];        return show(200,'经纬度获取成功',['res'=>$data]);    }}